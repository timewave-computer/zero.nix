<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Upload Contracts - Zero.nix Docs</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Zero.nix Docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/timewave-computer/zero.nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/timewave-computer/zero.nix/edit/main/manual/./guides/upload-contracts.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="upload-contracts"><a class="header" href="#upload-contracts">Upload Contracts</a></h1>
<p>Zero.nix provides the flake module
<a href="../reference/flake-modules/valence-contracts.html"><code>upload-contracts</code></a>
to automate the process of uploading contracts to cosmos based
chains.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Here is an example of a flake.nix that exports scripts to upload
valence_processor and valence_base_account contracts to neutron and juno.</p>
<pre><code class="language-nix">{
  nixConfig = {
    extra-substituters = "https://timewave.cachix.org";
    extra-trusted-public-keys = ''
      timewave.cachix.org-1:nu3Uqsm3sikI9xFK3Mt4AD4Q6z+j6eS9+kND1vtznq4=
    '';
  };

  description = "Uploading valence_authorization contract to neutron and juno";

  outputs = inputs @ {flake-parts, ...}:
    flake-parts.lib.mkFlake {inherit inputs;} {
      systems = [
        "x86_64-linux"
      ];
      perSystem = { lib, inputs', ... }: {
        upload-contracts = {
          networks.mainnet = {
            chainDefaults = { name, ... }: {
              contracts = {
                valence_authorization.package = inputs'.zero-nix.packages.valence-contracts-main;
                valence_base_account.package = inputs'.zero-nix.packages.valence-contracts-main;
              };
              chain-id = lib.mkDefault "${name}-1";
              max-fees = "1000000";
            };
            chains = {
              neutron = {
                chain-id = "neutron-1";
                node-address = "https://rpc-voidara.neutron-1.neutron.org";
                denom = "untrn";
              };
              juno = {
                chain-id = "juno-1";
                node-address = "https://juno-rpc.polkachu.com:443";
                denom = "ujuno";
              };
            };
          };
        };
      };
    };

  inputs = {
    nixpkgs.url = "github:nixos/nixpkgs";
    flake-parts.url = "github:hercules-ci/flake-parts";
    zero-nix.url = "github:timewave-computer/zero.nix";
  };
}
</code></pre>
<p>To then make use of the scripts use <code>nix run</code>.
Code IDs will be printed out in toml format.</p>
<h3 id="upload-contracts-to-an-individual-chain"><a class="header" href="#upload-contracts-to-an-individual-chain">Upload contracts to an individual chain</a></h3>
<p>Run <code>nix run .#&lt;network&gt;-&lt;chain&gt;-upload-contracts</code>.</p>
<p>For example, to upload neutron mainnet contracts run the following:</p>
<pre><code class="language-bash">nix run .#mainnet-neutron-upload-contracts -- --admin-address &lt;admin-address&gt;
</code></pre>
<p>Code ids will be printed out at the end in toml format.</p>
<h3 id="upload-contracts-to-a-network-of-chains"><a class="header" href="#upload-contracts-to-a-network-of-chains">Upload contracts to a network of chains</a></h3>
<p>To upload all contracts for every chain in a network use:</p>
<pre><code class="language-bash">nix run .#mainnet-upload-contracts -- --admin-address &lt;admin-key-name&gt;
</code></pre>
<p>This script will create a <code>contracts.toml</code> for the whole network in <code>mainnet-contracts/contracts.toml</code>.</p>
<p>The uploading process doesn't yet support command line arguments per chain, so when uploading a network of chains it is recommended to have addresses with the same key name for all chains and then pass the key name as the admin address.</p>
<p>If it is necessary to specify different admin addresses per chain, then it must be set in flake.nix with the <code>admin-address</code> key. To override the mainnet neutron admin-address, for example, go to the "networks.mainnet.chains" section of flake.nix and set admin-address like so:</p>
<pre><code class="language-nix">networks.mainnet.chains = {
  neutron = {
    admin-address = "neutron1...";
</code></pre>
<h3 id="customizing-contract-uploads"><a class="header" href="#customizing-contract-uploads">Customizing contract uploads</a></h3>
<p>The contract uploading script can be passed various arguments similar to how the admin address was passed above. To see all the arguments of the script run:</p>
<pre><code class="language-bash">nix run github:timewave-computer/zero.nix#upload-contract -- --help
</code></pre>
<p>Note: all options have to be passed after the "--" to ensure they get passed to the script instead of the nix command.</p>
<p>Every option has an equivalent environment variable as described in the help menu. These variables can optionally be set in flake.nix for declarative configuration. Options passed in the command line will always override settings in environment variables (or set through nix).</p>
<p>As an example, to upload neutron contracts with a different rpc, run:</p>
<pre><code class="language-bash">nix run .#mainnet-neutron-upload-contracts --admin-address &lt;admin-address&gt; --node-address &lt;rpc url&gt;
</code></pre>
<h3 id="manually-print-code-ids"><a class="header" href="#manually-print-code-ids">Manually print code ids</a></h3>
<p>A script is available to print the code ids of any collection of chains. To do so, run:</p>
<pre><code class="language-bash">nix run .#print-contracts-toml &lt;chain yaml files&gt;
</code></pre>
<p>The chain yaml files are the ones living in the contracts-data folder created by the upload scripts.</p>
<p>For example, to print the contracts.toml for contracts on just neutron and juno on mainnet, run:</p>
<pre><code class="language-bash">nix run .#print-contracts-toml mainnet/contracts-data/neutron.yaml mainnet/contracts-data/juno.yaml 
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guides/build-valence-contracts.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../guides/zk-development.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guides/build-valence-contracts.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../guides/zk-development.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
